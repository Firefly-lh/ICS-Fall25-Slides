---
theme: academic
highlighter: shiki
title: 06-Cache
info: |
  ICS 2025 Fall Slides
  Inspired by Arthals
  Presented by Firefly
presenter: false
titleTemplate: '%s'
class: text-center
drawings:
  persist: false
transition: fade-out
mdc: true
layout: cover
---

# 06-Cache

信息与计算科学 连昊

---

# 关于Cache Lab

- 截止时间: **11月13日晚23:59**
  - 注意Arch Lab的截止时间是**11月10日晚23:59**, 请注意时间分配
- 前置知识: 第六章(主要是6.4和6.5节)
- 提醒
  - 从本次Lab开始有助教评分环节, 请大家注意以下几点:
    - 码风清晰(至少不要大量压行, 推荐使用**格式化插件**) + 适当注释
    - 严守writeup中的要求: 在本次lab中, **不允许使用非法的数组和过量的局部变量**
  - 本lab的Part B关键在于**尽可能避免缓存冲突**, 你可能需要思考一些小trick来更好的利用缓存

---

# 作业题

Homeworks

6.30 重点题型且难度不大, 看懂6.4节即可

A. $C = S \times E \times B = 128bytes$

B. 
```
  12   11   10    9    8    7    6    5    4    3    2    1   0
+----+----+----+----+----+----+----+----+----+----+----+----+----+
| CT | CT | CT | CT | CT | CT | CT | CT | CI | CI | CI | CO | CO |
+----+----+----+----+----+----+----+----+----+----+----+----+----+
```

---

# 作业题

Homeworks

6.31

A. 
```
  12   11   10    9    8    7    6    5    4    3    2    1   0
+----+----+----+----+----+----+----+----+----+----+----+----+----+
|  0 |  0 |  1 |  1 |  1 |  0 |  0 |  0 |  1 |  1 |  0 |  1 |  0 |
+----+----+----+----+----+----+----+----+----+----+----+----+----+
```

B. `0x02` `0x06` `0x38` `命中` `0xEB`

---

# 作业题

Homeworks

6.32

A.
```
  12   11   10    9    8    7    6    5    4    3    2    1   0
+----+----+----+----+----+----+----+----+----+----+----+----+----+
|  1 |  0 |  1 |  1 |  0 |  1 |  1 |  1 |  0 |  1 |  0 |  0 |  0 |
+----+----+----+----+----+----+----+----+----+----+----+----+----+

```

B. `0x00` `0x02` `0xB7` `未命中` `-`

6.33 `0x1788 - 0x178B` `0x16C8 - 0x16CB`

---

# 作业题

Homeworks

6.34 

注意L1缓存有32/16=2块, 每块恰能容纳数组的一行. 即src和dst的第0/2行映射到同一块中, 1/3行映射在同一块中. dst的访问是列优先的, 故总是冲突的. src当且仅当i, j奇偶性
不同时, dst和src加载到不同块上, 此时的下一次访问不冲突.
```
dst: m m m m  src: m m h m
     m m m m       m h m h
     m m m m       m m h m
     m m m m       m h m h 
```

6.35 缓存块足够大, 只会发生冷不命中
```
dst: m h h h  src: m h h h
     m h h h       m h h h
     m h h h       m h h h
     m h h h       m h h h 
```

---

# 作业题

Homeworks

5.13

A. 略去, 你可以参考[这个网站](https://dreamanddead.github.io/CSAPP-3e-Solutions/chapter5/5.13/)或是网上其它资料.

B. 浮点加法运算`vaddsd`, `CPE=3.0`

C. 加法运算`addq`, `CPE=1.0`

D. 浮点乘法操作不在关键路径上

---

# 作业题

Homeworks

5.14 & 5.15 & 5.16 

具体代码略, 同样可以参考[这个网站](https://dreamanddead.github.io/CSAPP-3e-Solutions/chapter5/5.14/)或是网上其它资料.

5.14 A. 加法始终在关键路径上, 虽然循环展开减少了迭代次数, 但单次迭代内的运算次数增加, 总次数不变.

5.14 B. 浮点加法同样在关键路径上, 运算总次数不会因循环展开而改变.

5.15 其它指令可能有一定的cost, 比如浮点乘法.

---

# 重点知识纲要

- 存储技术(这部分重点在于**记忆**)
  - 随机访问存储器(RAM)
    - 特性
      - 速度快(因为可以以任意顺序访问数据)
      - 依靠电路, 断电后数据不可恢复(因此常用于存储运行时产生的数据)
    - 静态RAM(SRAM): 速度快, 价格高, 更稳定(采用双稳态结构, **只要有电, SRAM中的数据就不变**), 常用于高速缓存
    - 动态RAM(DRAM): 速度慢, 价格低, 易被干扰, 需要不断刷新来保证数据的稳定性, 常用于主存
      - **重点掌握:** DRAM的组成(单元 -> 超单元 -> 芯片); DRAM的读取方式; 五类增强的DRAM **(重点关注各自的特色)**
    - 主存的访问方式(简单了解即可)

---

# 重点知识纲要

- 非易失性存储器/只读存储器(ROM): **断电后数据不丢失**
  - 重点: **ROM中的有些类型既可以读也可以写**, 只是由于历史原因统称为ROM
  - 经典的ROM: PROM/EPROM/EEPROM/闪存(同样的, **重点关注各自的特色**)
  - 磁盘
    - 存储量级显著高于RAM(GB~TB量级); 访问时间显著慢于RAM(ms量级) 
    - **重点掌握**: 磁盘结构(扇区 -> 磁道 -> 盘面 -> 盘片 -> 磁盘); 重点计算(磁盘容量和寻道时间); 内存设备的单位(课本P408 旁注)
    - 简单了解: 多区记录技术(更充分利用空间); 逻辑磁盘块; 连接I/O设备; 访问磁盘
  - 固态硬盘(SSD): 基于闪存的新型存储技术, 优于传统磁盘
    - 重点关注: 组成结构(闪存页 -> 闪存块 -> 闪存); 读写方式和特性
- 程序的局部性(写程序时, 希望有好的局部性, **本质是更好的利用缓存**)
  - 空间局部性: 相邻位置的变量被集中访问(例子: 数组行优先访问快于列优先访问)
  - 时间局部性: 同一变量在短时间内被重复访问
  - 注意: 指令也是数据的一种, 也有局部性(例子: 循环)

---

# 重点知识纲要

- 存储器层次架构(金字塔, 关注课本P421 图6-21)
  - 核心思想: 缓存
    - 重点关注缓存的运作机制: 命中 / 不命中(了解下不命中的类型) / 替换策略
- 高速缓存 **(重点内容, 这部分要求理解和运用)**
  - **重点题型: 如何根据具体的地址从给定的缓存中读出相应的字段, 以及替换策略**
    - 读取(三步走): 组选择 -> 行匹配(**标记位匹配且有效位有效**) -> 字选择
  - 小思考: 为什么选择中间的位作为索引? (课本P432 旁注)
  - 读写策略: 写回/直写; 写分配/非写分配
    - 一般来说, 写回+直写分配(更好的利用了局部性, 效率更高), 直写+非写分配(实现相对容易, 适合读写惩罚相对较小时)
  - 不同的缓存组织结构: 直接映射 / 组相联 / 全相联
    - **重点: 高速缓存参数对缓存性能的影响(课本P439 6.4.7节)**
- 简单了解: 编写高速缓存友好的代码 & 存储器山 (通过Cache Lab你会对这块有比较深的认识)

---
layout: end
---

# Thanks for listening!